#!/usr/bin/env ruby

require "bundler/setup"
Bundler.require(:default)

require "active_support/core_ext/module/delegation"
require "active_support/core_ext/object/blank"
require "byebug"
require "interactor"

require_relative "../app/interactors/build_commands"
require_relative "../app/interactors/execute_commands"
require_relative "../app/interactors/extract_words"
require_relative "../app/interactors/open"

DEFAULT_FILE = "vocabulary/in.txt"

def prompt_for_text
  puts "Enter your text and press Enter (Ctrl+D to finish):"
  
  # Returns an array of strings
  # Waits for user input until the Ctrl+D combination is pressed
  $stdin.readlines
end

def read_file
  file_path = ARGV[1].presence || DEFAULT_FILE

  # Opens the file and reads its content, splitting it into an array of lines,
  # where each element of the array represents one line from the file.
  File.readlines(file_path)

  # Returns the content of the file as a single string.
  # Suitable for small files.
  # File.open(<file_name>, "r").read
end

def user_input
  case ARGV[0]
  when "terminal"
    prompt_for_text
  when "file"
    read_file
  else
    puts "Usage: bin/open [terminal|file <file_name>]"
    exit(1)
  end
end

def main
  Open.call(user_input: user_input)
end

if __FILE__ == $PROGRAM_NAME
  main
end
